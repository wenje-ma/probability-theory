## 2.3 Borel-Cantelli 引理
### 2.3.1 定义: 集合序列的上极限与下极限
设 $(\Omega,\mathcal{F},P)$ 为概率空间, $\{A_n\}_{n = 1}^\infty\subset\mathcal{F}$ 为事件列, 定义其**上下极限**如下: 
1.  **上极限** (无穷多次发生事件, 记为 $\{A_n \text{ i.o.}\}$) 

单调递减集合序列 $\{\bigcup_{n=m}^\infty A_n\}_{m=1}^\infty$ 的极限, 即
$$
\limsup_{n \to \infty} A_n = \bigcap_{m=1}^\infty \bigcup_{n=m}^\infty A_n = \{\omega \in \Omega: \omega \text{ 属于无穷多个 } A_n\}
$$

2. **下极限** (至多有限次不发生事件) 

单调递增集合序列 $\{\bigcap_{n=m}^\infty A_n\}_{m=1}^\infty$ 的极限, 即
$$
\liminf_{n \to \infty} A_n = \bigcup_{m=1}^\infty \bigcap_{n=m}^\infty A_n = \{\omega \in \Omega: \omega \text{ 至多不属于有限个 } A_n\}
$$
**核心关系**: $\liminf_{n \to \infty} A_n \subset \limsup_{n \to \infty} A_n$, 仅当序列极限存在时二者相等. 

### 2.3.2 定义: 集合上下极限与指示函数的关系
对任意事件列 $\{A_n\}$, 其指示函数 ($1_A(\omega)=1$ 若 $\omega\in A$, 否则为 $0$) 的上下极限满足
$$
\limsup_{n \to \infty} 1_{A_n} = 1_{\limsup_{n \to \infty} A_n}, \quad \liminf_{n \to \infty} 1_{A_n} = 1_{\liminf_{n \to \infty} A_n}
$$
该关系是连接**集合运算**与**期望计算**的关键桥梁, 可将事件列的概率性质转化为随机变量序列的期望性质. 

### 2.3.3 引理: 事件的 Fatou 引理 (Exer. 2.3.1)
对任意事件列 $\{A_n\}\subset\mathcal{F}$, 概率测度的上下极限满足不等式
$$
P( \limsup_{n\to\infty}A_n ) \ge \limsup_{n\to\infty}P(A_n)
$$
$$
P( \liminf_{n\to\infty}A_n ) \le \liminf_{n\to\infty}P(A_n)
$$

#### 证明
对指示函数序列 $\{1_{A_n}\}$ 应用**Fatou 引理**: 
- 上极限不等式: $E(\limsup_{n \to \infty}1_{A_n}) \ge \limsup_{n \to \infty}E(1_{A_n})$, 结合 2.3.2 的指示函数关系, 得 $P(\limsup_{n \to \infty}A_n) \ge \limsup_{n \to \infty}P(A_n)$; 
- 下极限不等式: $E(\liminf_{n \to \infty}1_{A_n}) \le \liminf_{n \to \infty}E(1_{A_n})$, 同理可得 $P(\liminf_{n \to \infty}A_n) \le \liminf_{n \to \infty}P(A_n)$. 

### 2.3.4 定理: 第一 Borel-Cantelli 引理 (Thm. 2.3.1)
若事件列 $\{A_n\}$ 满足**概率和收敛**, 即 $\sum_{n=1}^\infty P(A_n) < \infty$, 则无穷多次发生事件的概率为 $0$, 即
$$
P( A_n \text{ i.o.} ) = 0
$$

#### 证明
构造随机变量 $N = \sum_{n=1}^\infty 1_{A_n}$, 表示发生的事件总数; 

由**Fubini 定理** (非负随机变量可交换求和与期望顺序) : 
$$
EN = E( \sum_{n=1}^\infty 1_{A_n} ) = \sum_{n=1}^\infty E1_{A_n} = \sum_{n=1}^\infty P(A_n) < \infty
$$
期望有限的随机变量**几乎必然取有限值**, 即 $\omega$ 至多属于有限个 $A_n$, 故 $P(A_n \text{ i.o.}) = 0$. 

### 2.3.5 定理: 依概率收敛的子序列原理 (Thm. 2.3.2)
随机变量序列 $X_n \xrightarrow{P} X$ 当且仅当: 对任意子序列 $\{X_{n(m)}\}_{m=1}^\infty$, 存在进一步的子序列 $\{X_{n(m_k)}\}_{k=1}^\infty$ **几乎必然收敛**到 $X$ ($X_{n(m_k)} \xrightarrow{\text{a.s.}} X$) . 

#### 证明
1.  **必要性** ($\xrightarrow{P} \implies$ 子列 a.s. 收敛) 


设 $X_n \xrightarrow{P} X$, 取 $\epsilon_k = 1/k$. 此时存在子列 $\{n(m_k)\}$ 满足
$$
P(|X_{n(m_k)} - X| > 1/k) < 1/2^k
$$
由于 $\sum_{k=1}^\infty P(|X_{n(m_k)} - X| > 1/k) < \infty$, 由**第一 Borel-Cantelli 引理**, $P(|X_{n(m_k)} - X| > 1/k \text{ i.o.}) = 0$, 即 $X_{n(m_k)} \xrightarrow{\text{a.s.}} X$. 

2. **充分性** (子列 a.s. 收敛 $\implies \xrightarrow{P}$) 

反证法. 若 $X_n$ 不依概率收敛到 $X$, 则存在 $\epsilon_0>0$ 与子列 $\{n(m)\}$, 使得
$$
P(|X_{n(m)} - X| > \epsilon_0) \ge \delta>0
$$
对所有 $m$ 成立. 该子列无任何子列几乎必然收敛到 $X$, 与条件矛盾. 故 $X_n \xrightarrow{P} X$. 

### 2.3.6 定理: 连续映射定理 (Thm. 2.3.3)
设 $f:\mathbb{R}\to\mathbb{R}$ 为连续函数, 随机变量序列 $X_n \xrightarrow{P} X$, 则
1.  $f(X_n) \xrightarrow{P} f(X)$; 
2.  若 $f$ 有界, 则 $Ef(X_n) \to Ef(X)$. 

#### 证明
1.  **依概率收敛的连续映射**


任取子序列 $\{X_{n(m)}\}$, 由 Thm. 2.3.2 存在子列 $X_{n(m_k)} \xrightarrow{\text{a.s.}} X$. 

连续函数**保几乎必然收敛**, 即 $f(X_{n(m_k)}) \xrightarrow{\text{a.s.}} f(X)$, 再由 Thm. 2.3.2 得 $f(X_n) \xrightarrow{P} f(X)$. 

2. **有界连续函数的期望收敛**

由 $X_{n(m_k)} \xrightarrow{\text{a.s.}} X$ 与 $f$ 有界, 根据**控制收敛定理**, $Ef(X_{n(m_k)}) \to Ef(X)$. 

再由子序列原理, $Ef(X_n) \to Ef(X)$. 

### 2.3.7 示例: Borel-Cantelli 引理的逆命题反例 (Ex. 2.3.6)
设 $\Omega=(0,1)$, $\mathcal{F}$ 为 Borel 集族, $P$ 为 Lebesgue 测度, 取 $A_n=(0,a_n)$: 
1.  若 $a_n \to 0$, 则 $\limsup_{n \to \infty} A_n = \emptyset$, 故 $P(A_n \text{ i.o.}) = 0$; 
2.  取 $a_n = 1/n$, 则 $\sum_{n=1}^\infty P(A_n) = \sum_{n=1}^\infty 1/n = \infty$, 但 $P(A_n \text{ i.o.}) = 0$. 

该例表明: **概率和发散不能直接推出 $P(A_n \text{ i.o.})>0$**, 第二引理的独立性条件不可或缺. 

### 2.3.8 定理: 第二 Borel-Cantelli 引理 (Thm. 2.3.7)
若事件列 $\{A_n\}$ **相互独立**且 $\sum_{n=1}^\infty P(A_n) = \infty$, 则
$$
P( A_n \text{ i.o.} ) = 1
$$

#### 证明
对任意 $M < N$, 由**独立性**与不等式 $1 - x \le e^{-x}$ ($x\ge0$) , 有
$$
P( \bigcap_{n=M}^N A_n^c ) = \prod_{n=M}^N (1 - P(A_n)) \le \exp( -\sum_{n=M}^N P(A_n) )
$$
因 $\sum_{n=1}^\infty P(A_n) = \infty$, 当 $N \to \infty$ 时, $\sum_{n=M}^N P(A_n) \to \infty$, 故
$$
P( \bigcap_{n=M}^N A_n^c ) \to 0
$$
由**De Morgan 律**, $\bigcup_{n=M}^\infty A_n = ( \bigcap_{n=M}^\infty A_n^c )^c$, 故 $P( \bigcup_{n=M}^\infty A_n ) = 1$. 

又 $\{\bigcup_{n=M}^\infty A_n\}$ 单调递减到 $\limsup_{n \to \infty} A_n$, 由**概率的上连续性**: 
$$
P( \limsup_{n \to \infty} A_n ) = \lim_{M \to \infty} P( \bigcup_{n=M}^\infty A_n ) = 1
$$

